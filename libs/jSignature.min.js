/*
 
jSignature v2 "2012-10-31T10:38" "commit ID 1c397301e1509a3bdf0ea1ccfcaea5405d5cdbb5"
Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
Copyright (c) 2010 Brinley Ang http://www.unbolt.net
MIT License <http://www.opensource.org/licenses/mit-license.php> 


Simplify.js BSD 
(c) 2012, Vladimir Agafonkin
mourner.github.com/simplify-js


base64 encoder
MIT, GPL
http://phpjs.org/functions/base64_encode
+   original by: Tyler Akins (http://rumkin.com)
+   improved by: Bayron Guevara
+   improved by: Thunder.m
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   bugfixed by: Pellentesque Malesuada
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   improved by: Rafal Kukawski (http://kukawski.pl)


jSignature v2 jSignature's Undo Button and undo functionality plugin


jSignature v2 jSignature's custom "base30" format export and import plugins.


jSignature v2 SVG export plugin.

*/
(function(){function s(b){for(var f,p=b.css("color"),y,b=b[0],c=!1;b&&!y&&!c;){try{f=$(b).css("background-color")}catch(g){f="transparent"}"transparent"!==f&&"rgba(0, 0, 0, 0)"!==f&&(y=f);c=b.body;b=b.parentNode}var b=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,c=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,a;f=void 0;(f=p.match(b))?a={r:parseInt(f[1],10),g:parseInt(f[2],10),b:parseInt(f[3],10)}:(f=p.match(c))&&(a={r:parseInt(f[1],16),g:parseInt(f[2],16),b:parseInt(f[3],16)});var d;y?
(f=void 0,(f=y.match(b))?d={r:parseInt(f[1],10),g:parseInt(f[2],10),b:parseInt(f[3],10)}:(f=y.match(c))&&(d={r:parseInt(f[1],16),g:parseInt(f[2],16),b:parseInt(f[3],16)})):d=a?127<Math.max.apply(null,[a.r,a.g,a.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255}:{r:255,g:255,b:255};f=function(b){return"rgb("+[b.r,b.g,b.b].join(", ")+")"};a&&d?(b=Math.max.apply(null,[a.r,a.g,a.b]),a=Math.max.apply(null,[d.r,d.g,d.b]),a=Math.round(a+-0.75*(a-b)),a={r:a,g:a,b:a}):a?(a=Math.max.apply(null,[a.r,a.g,a.b]),b=1,127<a&&
(b=-1),a=Math.round(a+96*b),a={r:a,g:a,b:a}):a={r:191,g:191,b:191};return{color:p,"background-color":d?f(d):y,"decor-color":f(a)}}function m(b,f){this.x=b;this.y=f;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var p=function(b){return Math.round(b/Math.abs(b))};this.resizeTo=function(b){if(0===this.x&&0===this.y)this._length=0;else if(0===
this.x)this._length=b,this.y=b*p(this.y);else if(0===this.y)this._length=b,this.x=b*p(this.x);else{var f=Math.abs(this.y/this.x),a=Math.sqrt(Math.pow(b,2)/(1+Math.pow(f,2))),f=f*a;this._length=b;this.x=a*p(this.x);this.y=f*p(this.y)}return this};this.angleTo=function(b){var f=this.getLength()*b.getLength();return 0===f?0:Math.acos(Math.min(Math.max((this.x*b.x+this.y*b.y)/f,-1),1))/Math.PI}}function h(b,f){this.x=b;this.y=f;this.getVectorToCoordinates=function(b,f){return new m(b-this.x,f-this.y)};
this.getVectorFromCoordinates=function(b,f){return this.getVectorToCoordinates(b,f).reverse()};this.getVectorToPoint=function(b){return new m(b.x-this.x,b.y-this.y)};this.getVectorFromPoint=function(b){return this.getVectorToPoint(b).reverse()}}function t(b,f,a,c,g){this.data=b;this.context=f;if(b.length)for(var d=b.length,j,i,e=0;e<d;e++){j=b[e];i=j.x.length;a.call(f,j);for(var h=1;h<i;h++)c.call(f,j,h);g.call(f,j)}this.changed=function(){};this.startStrokeFn=a;this.addToStrokeFn=c;this.endStrokeFn=
g;this.inStroke=!1;this._stroke=this._lastPoint=null;this.startStroke=function(b){if(b&&"number"==typeof b.x&&"number"==typeof b.y){this._stroke={x:[b.x],y:[b.y]};this.data.push(this._stroke);this._lastPoint=b;this.inStroke=!0;var f=this._stroke,a=this.startStrokeFn,p=this.context;setTimeout(function(){a.call(p,f)},3);return b}return null};this.addToStroke=function(b){if(this.inStroke&&"number"===typeof b.x&&"number"===typeof b.y&&4<Math.abs(b.x-this._lastPoint.x)+Math.abs(b.y-this._lastPoint.y)){var f=
this._stroke.x.length;this._stroke.x.push(b.x);this._stroke.y.push(b.y);this._lastPoint=b;var a=this._stroke,p=this.addToStrokeFn,c=this.context;setTimeout(function(){p.call(c,a,f)},3);return b}return null};this.endStroke=function(){var b=this.inStroke;this.inStroke=!1;this._lastPoint=null;if(b){var f=this._stroke,a=this.endStrokeFn,p=this.context,c=this.changed;setTimeout(function(){a.call(p,f);c.call(p)},3);return!0}return null}}function q(b,f,a){var c=this.$parent=$(b),b=this.eventTokens={};this.events=
new u(this);var g=$.fn[e]("globalEvents"),d={width:"ratio",height:"ratio",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:!1,data:[]};$.extend(d,s(c));f&&$.extend(d,f);this.settings=d;for(var j in a)a.hasOwnProperty(j)&&a[j].call(this,j);this.events.publish(e+".initializing");this.$controlbarUpper=$('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1em !important;margin-bottom:1em !important;"></div>').appendTo(c);
this.isCanvasEmulator=!1;a=this.canvas=this.initializeCanvas(d);f=$(a);this.$controlbarLower=$('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1.5em !important;margin-bottom:1.5em !important;"></div>').appendTo(c);this.canvasContext=a.getContext("2d");f.data(e+".this",this);c=(c=d.lineWidth)?c:Math.max(Math.round(a.width/400),2);d.lineWidth=c;this.lineCurveThreshold=3*d.lineWidth;d.cssclass&&""!=$.trim(d.cssclass)&&f.addClass(d.cssclass);
this.fatFingerCompensation=0;var c=function(b){var f,a,c=function(c){c=c.changedTouches&&0<c.changedTouches.length?c.changedTouches[0]:c;return new h(Math.round(c.pageX+f),Math.round(c.pageY+a)+b.fatFingerCompensation)},p=new z(750,function(){b.dataEngine.endStroke()});this.drawEndHandler=function(f){try{f.preventDefault()}catch(a){}p.clear();b.dataEngine.endStroke()};this.drawStartHandler=function(d){d.preventDefault();var g=$(b.canvas).offset();f=-1*g.left;a=-1*g.top;b.dataEngine.startStroke(c(d));
p.kick()};this.drawMoveHandler=function(f){f.preventDefault();b.dataEngine.inStroke&&(b.dataEngine.addToStroke(c(f)),p.kick())};return this}.call({},this),i=c.drawEndHandler,k=c.drawStartHandler,l=c.drawMoveHandler,n=this.canvas,f=$(n);this.isCanvasEmulator?(f.bind("mousemove."+e,l),f.bind("mouseup."+e,i),f.bind("mousedown."+e,k)):(n.ontouchstart=function(b){n.onmousedown=void 0;n.onmouseup=void 0;n.onmousemove=void 0;this.fatFingerCompensation=d.minFatFingerCompensation&&-3*d.lineWidth>d.minFatFingerCompensation?
-3*d.lineWidth:d.minFatFingerCompensation;k(b);n.ontouchend=i;n.ontouchstart=k;n.ontouchmove=l},n.onmousedown=function(b){n.ontouchstart=void 0;n.ontouchend=void 0;n.ontouchmove=void 0;k(b);n.onmousedown=k;n.onmouseup=i;n.onmousemove=l});b[e+".windowmouseup"]=g.subscribe(e+".windowmouseup",c.drawEndHandler);this.events.publish(e+".attachingEventHandlers");var r=this,b=d.width.toString(10),x=e;if("ratio"===b||"%"===b.split("")[b.length-1])this.eventTokens[x+".parentresized"]=g.subscribe(x+".parentresized",
function(b,f,a){return function(){var c=f.width();if(c!==a){for(var p in b)b.hasOwnProperty(p)&&(g.unsubscribe(b[p]),delete b[p]);var d=r.settings;r.$parent.children().remove();for(p in r)r.hasOwnProperty(p)&&delete r[p];p=d.data;var c=1*c/a,y=[],j,i,e,k,h,n;i=0;for(e=p.length;i<e;i++){n=p[i];j={x:[],y:[]};k=0;for(h=n.x.length;k<h;k++)j.x.push(n.x[k]*c),j.y.push(n.y[k]*c);y.push(j)}d.data=y;f[x](d)}}}(this.eventTokens,this.$parent,this.$parent.width(),1*this.canvas.width/this.canvas.height));this.resetCanvas(d.data);
this.events.publish(e+".initialized");return this}var e="jSignature",z=function(b,f){var a;this.kick=function(){clearTimeout(a);a=setTimeout(f,b)};this.clear=function(){clearTimeout(a)};return this},u=function(b){this.topics={};this.context=b?b:this;this.publish=function(b,a,c,d){if(this.topics[b]){var g=this.topics[b],j=Array.prototype.slice.call(arguments,1),i=[],k,e,h,n;e=0;for(h=g.length;e<h;e++)n=g[e],k=n[0],n[1]&&(n[0]=function(){},i.push(e)),k.apply(this.context,j);e=0;for(h=i.length;e<h;e++)g.splice(i[e],
1)}};this.subscribe=function(b,a,c){this.topics[b]?this.topics[b].push([a,c]):this.topics[b]=[[a,c]];return{topic:b,callback:a}};this.unsubscribe=function(b){if(this.topics[b.topic])for(var a=this.topics[b.topic],c=0,d=a.length;c<d;c++)a[c][0]===b.callback&&a.splice(c,1)}},A=function(b){var f=this.canvasContext,a=b.x[0],b=b.y[0],c=this.settings.lineWidth,d=f.fillStyle;f.fillStyle=f.strokeStyle;f.fillRect(a+c/-2,b+c/-2,c,c);f.fillStyle=d},v=function(b,f){var a=new h(b.x[f-1],b.y[f-1]),c=new h(b.x[f],
b.y[f]),d=a.getVectorToPoint(c);if(1<f){var g=new h(b.x[f-2],b.y[f-2]),j=g.getVectorToPoint(a),i;if(j.getLength()>this.lineCurveThreshold){i=2<f?(new h(b.x[f-3],b.y[f-3])).getVectorToPoint(g):new m(0,0);var e=0.35*j.getLength(),k=j.angleTo(i.reverse()),n=d.angleTo(j.reverse());i=(new m(i.x+j.x,i.y+j.y)).resizeTo(Math.max(0.05,k)*e);var l=(new m(j.x+d.x,j.y+d.y)).reverse().resizeTo(Math.max(0.05,n)*e),j=this.canvasContext,e=g.x,n=g.y,k=a.x,r=a.y,x=g.x+i.x,g=g.y+i.y;i=a.x+l.x;l=a.y+l.y;j.beginPath();
j.moveTo(e,n);j.bezierCurveTo(x,g,i,l,k,r);j.stroke()}}d.getLength()<=this.lineCurveThreshold&&(d=this.canvasContext,g=a.x,a=a.y,i=c.x,c=c.y,d.beginPath(),d.moveTo(g,a),d.lineTo(i,c),d.stroke())},w=function(b){var a=b.x.length-1;if(0<a){var c=new h(b.x[a],b.y[a]),d=new h(b.x[a-1],b.y[a-1]),g=d.getVectorToPoint(c);if(g.getLength()>this.lineCurveThreshold){if(1<a){var b=(new h(b.x[a-2],b.y[a-2])).getVectorToPoint(d),j=(new m(b.x+g.x,b.y+g.y)).resizeTo(g.getLength()/2),g=this.canvasContext,b=d.x,a=d.y,
i=c.x,e=c.y,k=d.x+j.x,d=d.y+j.y,j=c.x,c=c.y;g.beginPath();g.moveTo(b,a);g.bezierCurveTo(k,d,j,c,i,e)}else g=this.canvasContext,b=d.x,d=d.y,a=c.x,c=c.y,g.beginPath(),g.moveTo(b,d),g.lineTo(a,c);g.stroke()}}};q.prototype.resetCanvas=function(b){var a=this.canvas,c=this.settings,d=this.canvasContext,g=this.isCanvasEmulator,j=a.width,i=a.height;d.clearRect(0,0,j+30,i+30);d.shadowColor=d.fillStyle=c["background-color"];g&&d.fillRect(0,0,j+30,i+30);d.lineWidth=Math.ceil(parseInt(c.lineWidth,10));d.lineCap=
d.lineJoin="round";d.strokeStyle=c["decor-color"];d.shadowOffsetX=0;d.shadowOffsetY=0;var k=Math.round(i/5),n=1.5*k,h=i-k,j=j-1.5*k,i=i-k;d.beginPath();d.moveTo(n,h);d.lineTo(j,i);d.stroke();d.strokeStyle=c.color;g||(d.shadowColor=d.strokeStyle,d.shadowOffsetX=0.5*d.lineWidth,d.shadowOffsetY=-0.6*d.lineWidth,d.shadowBlur=0);b||(b=[]);d=this.dataEngine=new t(b,this,A,v,w);c.data=b;$(a).data(e+".data",b).data(e+".settings",c);var l=this.$parent,r=this.events,x=e;d.changed=function(){r.publish(x+".change");
l.trigger("change")};d.changed();return!0};q.prototype.initializeCanvas=function(b){var a=document.createElement("canvas"),c=$(a);b.width===b.height&&"ratio"===b.height&&(b.width="100%");c.css("margin",0).css("padding",0).css("border","none").css("height","ratio"===b.height||!b.height?1:b.height.toString(10)).css("width","ratio"===b.width||!b.width?1:b.width.toString(10));c.appendTo(this.$parent);"ratio"===b.height?c.css("height",Math.round(c.width()/b.sizeRatio)):"ratio"===b.width&&c.css("width",
Math.round(c.height()*b.sizeRatio));c.addClass(e);a.width=c.width();a.height=c.height();b=a;if(b.getContext)b=!1;else if("undefined"!==typeof FlashCanvas)b=FlashCanvas.initElement(b),c=1,window&&(window.screen&&window.screen.deviceXDPI&&window.screen.logicalXDPI)&&(c=1*window.screen.deviceXDPI/window.screen.logicalXDPI),1!==c&&($(b).children("object").get(0).resize(Math.ceil(b.width*c),Math.ceil(b.height*c)),b.getContext("2d").scale(c,c)),b=!0;else throw Error("Canvas element does not support 2d context. jSignature cannot proceed.");
this.isCanvasEmulator=b;a.onselectstart=function(b){b&&b.preventDefault&&b.preventDefault();b&&b.stopPropagation&&b.stopPropagation();return!1};return a};var k=function(b,c){var a=new Image,d=this;a.onload=function(){d.getContext("2d").drawImage(a,0,0,a.width<d.width?a.width:d.width,a.height<d.height?a.height:d.height)};a.src="data:"+c+","+b},r=function(b){this.find("canvas."+e).add(this.filter("canvas."+e)).data(e+".this").resetCanvas(b);return this},a=function(b,a){if(void 0===a&&("string"===typeof b&&
"data:"===b.substr(0,5))&&(a=b.slice(5).split(",")[0],b=b.slice(6+a.length),a===b))return;var c=this.find("canvas."+e).add(this.filter("canvas."+e));if(x.hasOwnProperty(a))0!==c.length&&x[a].call(c[0],b,a,function(b){return function(){return b.resetCanvas.apply(b,arguments)}}(c.data(e+".this")));else throw Error(e+" is unable to find import plugin with for format '"+String(a)+"'");return this},d=new u,g=e,c,j=function(){d.publish(g+".parentresized")};$(window).bind("resize."+g,function(){c&&clearTimeout(c);
c=setTimeout(j,500)}).bind("mouseup."+g,function(){d.publish(g+".windowmouseup")});var i={},n={"default":function(){return this.toDataURL()},"native":function(b){return b},image:function(){var b=this.toDataURL();if("string"===typeof b&&4<b.length&&"data:"===b.slice(0,5)&&-1!==b.indexOf(",")){var a=b.indexOf(",");return[b.slice(5,a),b.substr(a+1)]}return[]}},x={"native":function(b,a,c){c(b)},image:k,"image/png;base64":k,"image/jpeg;base64":k,"image/jpg;base64":k},l={"export":n,"import":x,instance:i},
B={init:function(b){return this.each(function(){var a,c=!1;for(a=this.parentNode;a&&!c;)c=a.body,a=a.parentNode;!c||new q(this,b,i)})},getSettings:function(){return this.find("canvas."+e).add(this.filter("canvas."+e)).data(e+".this").settings},clear:r,reset:r,addPlugin:function(b,a,c){l.hasOwnProperty(b)&&(l[b][a]=c);return this},listPlugins:function(b){var a=[];if(l.hasOwnProperty(b)){var b=l[b],c;for(c in b)b.hasOwnProperty(c)&&a.push(c)}return a},getData:function(b){var a=this.find("canvas."+e).add(this.filter("canvas."+
e));void 0===b&&(b="default");if(0!==a.length&&n.hasOwnProperty(b))return n[b].call(a.get(0),a.data(e+".data"))},importData:a,setData:a,globalEvents:function(){return d},events:function(){return this.find("canvas."+e).add(this.filter("canvas."+e)).data(e+".this").events}};$.fn[e]=function(b){if(!b||"object"===typeof b)return B.init.apply(this,arguments);if("string"===typeof b&&B[b])return B[b].apply(this,Array.prototype.slice.call(arguments,1));$.error("Method "+String(b)+" does not exist on jQuery."+
e)}})();
(function(){$.fn.jSignature("addPlugin","instance","UndoButton",function(s){this.events.subscribe("jSignature.attachingEventHandlers",function(){if(this.settings[s]){var m=this.settings[s];"function"!==typeof m&&(m=function(){var e=$('<input type="button" value="Undo last stroke" style="position:absolute;display:none;margin:0 !important;top:auto" />').appendTo(this.$controlbarLower),h=e.width();e.css("left",Math.round((this.canvas.width-h)/2));h!==e.width()&&e.width(h);return e});var h=m.call(this),t=
this;t.events.subscribe("jSignature.change",function(){t.dataEngine.data.length?h.show():h.hide()});var q=this,e=(this.events.topics.hasOwnProperty("jSignature.undo")?s:"jSignature")+".undo";h.bind("click",function(){q.events.publish(e)});q.events.subscribe(e,function(){var e=q.dataEngine.data;e.length&&(e.pop(),q.resetCanvas(e))})}})})})();
(function(){for(var s={},m={},h="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split(""),t=h.length/2,q=t-1;-1<q;q--)s[h[q]]=h[q+t],m[h[q+t]]=h[q];var e=function(e){for(var e=e.split(""),h=e.length,a=1;a<h;a++)e[a]=s[e[a]];return e.join("")},z=function(h){for(var r=[],a=0,d=1,g=h.length,c,j,i=0;i<g;i++)c=Math.round(h[i]),j=c-a,a=c,0>j&&0<d?(d=-1,r.push("Z")):0<j&&0>d&&(d=1,r.push("Y")),c=Math.abs(j),c>=t?r.push(e(c.toString(t))):r.push(c.toString(t));return r.join("")},u=function(e){for(var h=
[],e=e.split(""),a=e.length,d,g=1,c=[],j=0,i=0;i<a;i++)d=e[i],d in s||"Z"===d||"Y"===d?(0!==c.length&&(c=parseInt(c.join(""),t)*g+j,h.push(c),j=c),"Z"===d?(g=-1,c=[]):"Y"===d?(g=1,c=[]):c=[d]):c.push(m[d]);h.push(parseInt(c.join(""),t)*g+j);return h},A=function(e){for(var h=[],a=e.length,d,g=0;g<a;g++)d=e[g],h.push(z(d.x)),h.push(z(d.y));return h.join("_")},v=function(e){for(var h=[],e=e.split("_"),a=e.length/2,d=0;d<a;d++)h.push({x:u(e[2*d]),y:u(e[2*d+1])});return h},h=function(e){return["image/jsignature;base30",
A(e)]},q=function(e,h,a){"string"===typeof e&&("image/jsignature;base30"===e.substring(0,23).toLowerCase()&&(e=e.substring(24)),a(v(e)))};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");var w=this.jQuery.fn.jSignature;w("addPlugin","export","base30",h);w("addPlugin","export","image/jsignature;base30",h);w("addPlugin","import","base30",q);w("addPlugin","import","image/jsignature;base30",q);this.jSignatureDebug&&(this.jSignatureDebug.base30=
{remapTailChars:e,compressstrokeleg:z,uncompressstrokeleg:u,compressstrokes:A,uncompressstrokes:v,charmap:s})}).call("undefined"!==typeof window?window:this);
(function(){function s(a,d){this.x=a;this.y=d;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var g=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=a,this.y=a*g(this.y);else if(0===this.y)this._length=a,this.x=a*g(this.x);else{var d=Math.abs(this.y/
this.x),e=Math.sqrt(Math.pow(a,2)/(1+Math.pow(d,2))),d=d*e;this._length=a;this.x=e*g(this.x);this.y=d*g(this.y)}return this};this.angleTo=function(a){var d=this.getLength()*a.getLength();return 0===d?0:Math.acos(Math.min(Math.max((this.x*a.x+this.y*a.y)/d,-1),1))/Math.PI}}function m(a,d){this.x=a;this.y=d;this.getVectorToCoordinates=function(a,c){return new s(a-this.x,c-this.y)};this.getVectorFromCoordinates=function(a,c){return this.getVectorToCoordinates(a,c).reverse()};this.getVectorToPoint=function(a){return new s(a.x-
this.x,a.y-this.y)};this.getVectorFromPoint=function(a){return this.getVectorToPoint(a).reverse()}}function h(a,d){var g=Math.pow(10,d);return Math.round(a*g)/g}function t(a,d,g){var d=d+1,c=new m(a.x[d-1],a.y[d-1]),e=new m(a.x[d],a.y[d]),e=c.getVectorToPoint(e),i=new m(a.x[d-2],a.y[d-2]),c=i.getVectorToPoint(c);return c.getLength()>g?(g=2<d?(new m(a.x[d-3],a.y[d-3])).getVectorToPoint(i):new s(0,0),a=0.35*c.getLength(),i=c.angleTo(g.reverse()),d=e.angleTo(c.reverse()),g=(new s(g.x+c.x,g.y+c.y)).resizeTo(Math.max(0.05,
i)*a),e=(new s(c.x+e.x,c.y+e.y)).reverse().resizeTo(Math.max(0.05,d)*a),e=new s(c.x+e.x,c.y+e.y),["c",h(g.x,2),h(g.y,2),h(e.x,2),h(e.y,2),h(c.x,2),h(c.y,2)]):["l",h(c.x,2),h(c.y,2)]}function q(a,d){var g=a.x.length-1,c=new m(a.x[g],a.y[g]),e=new m(a.x[g-1],a.y[g-1]),c=e.getVectorToPoint(c);if(1<g&&c.getLength()>d){var g=(new m(a.x[g-2],a.y[g-2])).getVectorToPoint(e),e=c.angleTo(g.reverse()),i=0.35*c.getLength(),g=(new s(g.x+c.x,g.y+c.y)).resizeTo(Math.max(0.05,e)*i);return["c",h(g.x,2),h(g.y,2),h(c.x,
2),h(c.y,2),h(c.x,2),h(c.y,2)]}return["l",h(c.x,2),h(c.y,2)]}function e(a,d,e){for(var d=["M",h(a.x[0]-d,2),h(a.y[0]-e,2)],e=1,c=a.x.length-1;e<c;e++)d.push.apply(d,t(a,e,1));0<c?d.push.apply(d,q(a,e,1)):0===c&&d.push.apply(d,["l",1,1]);return d.join(" ")}function z(a){var d=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],g,c=a.length,j,i=[],h=[],k=j=g=0,l=0,m=[];if(0!==c){for(g=0;g<c;g++){k=
a[g];l=[];j={x:[],y:[]};for(var b=void 0,f=void 0,b=0,f=k.x.length;b<f;b++)l.push({x:k.x[b],y:k.y[b]});l=simplify(l,0.7,!0);b=0;for(f=l.length;b<f;b++)j.x.push(l[b].x),j.y.push(l[b].y);m.push(j);i=i.concat(j.x);h=h.concat(j.y)}a=Math.min.apply(null,i)-1;c=Math.max.apply(null,i)+1;i=Math.min.apply(null,h)-1;h=Math.max.apply(null,h)+1;k=0>a?0:a;l=0>i?0:i;g=c-a;j=h-i}d.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+g.toString()+'" height="'+j.toString()+'">');g=0;for(c=m.length;g<
c;g++)j=m[g],d.push('<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="'+e(j,k,l)+'"/>');d.push("</svg>");return d.join("")}function u(a){return[k,z(a)]}function A(a){return[r,w(z(a))]}var v=window;"use strict";("undefined"!=typeof exports?exports:v).simplify=function(a,d,e){d=void 0!==d?d*d:1;if(!e){for(var c=a.length,j,i=a[0],h=[i],e=1;e<c;e++){j=a[e];var k=j.x-i.x,l=j.y-i.y;k*k+l*l>d&&(h.push(j),i=j)}a=(i!==j&&h.push(j),h)}j=a;var e=j.length,
c=new ("undefined"!=typeof Uint8Array?Uint8Array:Array)(e),i=0,h=e-1,m,b,f=[],p=[],r=[];for(c[i]=c[h]=1;h;){l=0;for(k=i+1;k<h;k++){m=j[k];var q=j[i],s=j[h],t=q.x,v=q.y,q=s.x-t,u=s.y-v,w=void 0;if(0!==q||0!==u)w=((m.x-t)*q+(m.y-v)*u)/(q*q+u*u),1<w?(t=s.x,v=s.y):0<w&&(t+=q*w,v+=u*w);m=(q=m.x-t,u=m.y-v,q*q+u*u);m>l&&(b=k,l=m)}l>d&&(c[b]=1,f.push(i),p.push(b),f.push(b),p.push(h));i=f.pop();h=p.pop()}for(k=0;k<e;k++)c[k]&&r.push(j[k]);return a=r,a};if("function"!==typeof w)var w=function(a){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),
e,c,h,i,k=0,m=0,l="",l=[];do e=a.charCodeAt(k++),c=a.charCodeAt(k++),h=a.charCodeAt(k++),i=e<<16|c<<8|h,e=i>>18&63,c=i>>12&63,h=i>>6&63,i&=63,l[m++]=d[e]+d[c]+d[h]+d[i];while(k<a.length);l=l.join("");a=a.length%3;return(a?l.slice(0,a-3):l)+"===".slice(a||3)};var k="image/svg+xml",r="image/svg+xml;base64";if("undefined"===typeof $)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");v=$.fn.jSignature;v("addPlugin","export","svg",u);v("addPlugin",
"export",k,u);v("addPlugin","export","svgbase64",A);v("addPlugin","export",r,A)})();