/*
 ==============
 jSignature v2
 Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
 Copyright (c) 2010 Brinley Ang http://www.unbolt.net
 MIT License <http://www.opensource.org/licenses/mit-license.php> 
 ==============
*/
(function(){if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(j){function q(b){for(var a,f=b.css("color"),c;void 0===c&&void 0!==b;){try{a=b.css("background-color")}catch(m){a="transparent"}"transparent"!==a&&"rgba(0, 0, 0, 0)"!==a&&(c=a);try{b=b.parent(),b[0]===document&&(b=void 0)}catch(g){b=void 0}}var b=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,d=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,
e;a=void 0;(a=f.match(b))?e={r:parseInt(a[1],10),g:parseInt(a[2],10),b:parseInt(a[3],10)}:(a=f.match(d))&&(e={r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)});var k;c?(a=void 0,(a=c.match(b))?k={r:parseInt(a[1],10),g:parseInt(a[2],10),b:parseInt(a[3],10)}:(a=c.match(d))&&(k={r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)})):k=e?127<Math.max.apply(null,[e.r,e.g,e.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255}:{r:255,g:255,b:255};a=function(c){return"rgb("+[c.r,c.g,c.b].join(", ")+
")"};e&&k?(b=Math.max.apply(null,[e.r,e.g,e.b]),e=Math.max.apply(null,[k.r,k.g,k.b]),e=Math.round(e+-0.75*(e-b)),e={r:e,g:e,b:e}):e?(e=Math.max.apply(null,[e.r,e.g,e.b]),b=1,127<e&&(b=-1),e=Math.round(e+96*b),e={r:e,g:e,b:e}):e={r:191,g:191,b:191};return{color:f,"background-color":k?a(k):c,"decor-color":a(e)}}function l(b,a){this.x=b;this.y=a;this.reverse=function(){this.x*=-1;this.y*=-1;return this};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,
2)+Math.pow(this.y,2)));return this._length};var f=function(c){return Math.round(c/Math.abs(c))};this.resizeTo=function(c){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=c,this.y=c*f(this.y);else if(0===this.y)this._length=c,this.x=c*f(this.x);else{var a=Math.abs(this.y/this.x),b=Math.sqrt(Math.pow(c,2)/(1+Math.pow(a,2))),a=a*b;this._length=c;this.x=b*f(this.x);this.y=a*f(this.y)}return this}}function r(b,a){this.x=b;this.y=a;this.getVectorToCoordinates=function(a,c){return new l(a-
this.x,c-this.y)};this.getVectorFromCoordinates=function(a,c){return this.getVectorToCoordinates(a,c).reverse()};this.getVectorToPoint=function(a){return new l(a.x-this.x,a.y-this.y)};this.getVectorFromPoint=function(a){return this.getVectorToPoint(a).reverse()}}function C(b){this._storageObject=b;this.startStrokeFn=function(){};this.addToStrokeFn=function(){};this.endStrokeFn=function(){};this.inStroke=!1;this._stroke=this._lastPoint=null;this.startStroke=function(a){if(a&&"number"==typeof a.x&&
"number"==typeof a.y){this._stroke={x:[a.x],y:[a.y]};this._storageObject.push(this._stroke);this._lastPoint=a;this.inStroke=!0;var b=this._stroke,c=this.startStrokeFn;setTimeout(function(){c(b)},3);return a}return null};this.addToStroke=function(a){if(this.inStroke&&"number"===typeof a.x&&"number"===typeof a.y&&2<Math.abs(a.x-this._lastPoint.x)+Math.abs(a.y-this._lastPoint.y)){var b=this._stroke.x.length;this._stroke.x.push(a.x);this._stroke.y.push(a.y);this._lastPoint=a;var c=this._stroke,m=this.addToStrokeFn;
setTimeout(function(){m(c,b)},3);return a}return null};this.endStroke=function(){var a=this.inStroke;this.inStroke=!1;this._lastPoint=null;if(a){var b=this.endStrokeFn,c=this._stroke;setTimeout(function(){b(c)},3);return!0}return null}}var D=function(b){var a={width:"max",height:"max",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0},f=j(this);j.extend(a,q(f));b&&j.extend(a,b);if("max"==a.width||"max"==a.height){var b=f.width(),c=f.height();b/a.sizeRatio>c&&(c=parseInt(b/
a.sizeRatio,10));a.width=b;a.height=c}0==a.lineWidth&&(b=parseInt(a.width,10),b=parseInt(b/300,10),a.lineWidth=2>b?2:b);var m=1E3>parseInt(a.width,10)?!0:!1,g=f.find("canvas"),d;g.length?d=g.get(0):(d=document.createElement("canvas"),d.width=a.width,d.height=a.height,g=j(d),g.appendTo(f));g.addClass("jSignature");var e=!1,k=1;d.getContext||("undefined"!==typeof FlashCanvas?(window&&window.screen&&window.screen.deviceXDPI&&window.screen.logicalXDPI&&(k=window.screen.deviceXDPI/window.screen.logicalXDPI),
d=FlashCanvas.initElement(d),1!=k&&g.children("object").get(0).resize(Math.ceil(d.width*k),Math.ceil(d.height*k)),e=!0):"undefined"!=typeof G_vmlCanvasManager&&(d=G_vmlCanvasManager.initElement(d),e=!0));if(!d.getContext)throw Error("Canvas element does not support 2d context. jSignature cannot proceed.");d.onselectstart=function(a){a&&a.preventDefault&&a.preventDefault();a&&a.stopPropagation&&a.stopPropagation();return false};a.cssclass&&""!=j.trim(a.cssclass)&&g.addClass(a.cssclass);var i=d.getContext("2d"),
h,z,E,F,s,o,p=-1*Math.round(a.lineWidth/2),G=function(a,c,d,b){i.beginPath();i.moveTo(a,c);i.lineTo(d,b);i.stroke()},f=function(c){var b=d.width,f=d.height;i.clearRect(0,0,b*k+30,f*k+30);i.shadowColor=i.fillStyle=a["background-color"];e&&i.fillRect(0,0,b*k+30,f*k+30);i.lineWidth=Math.ceil(parseInt(a.lineWidth,10)*k);i.lineCap=i.lineJoin="round";var l=Math.round(f/5);i.strokeStyle=a["decor-color"];i.shadowOffsetX=0;i.shadowOffsetY=0;G(l*1.5,f-l,b-l*1.5,f-l);i.strokeStyle=a.color;if(!e&&!m){i.shadowColor=
i.strokeStyle;i.shadowOffsetX=i.lineWidth*0.5;i.shadowOffsetY=i.lineWidth*-0.6;i.shadowBlur=0}if(c===void 0)c=[];else for(var b=c.length,j=0;j<b;j++){f=c[j];l=f.x.length;z(f);for(var n=1;n<l;n++)E(f,n);F(f)}h=new C(c);h.startStrokeFn=z;h.addToStrokeFn=E;h.endStrokeFn=F;g.data("jSignature.data",c);return true},A=null,n=function(a){try{a.preventDefault()}catch(c){}clearTimeout(A);h.endStroke()},B=0,v=function(a){a=a.changedTouches&&a.changedTouches.length>0?a.changedTouches[0]:a;return new r(Math.round((a.pageX+
s)*k),Math.round((a.pageY+o)*k)+B)},t=function(a){a.preventDefault();var c=g.offset();s=c.left*-1;o=c.top*-1;h.startStroke(v(a));clearTimeout(A);A=setTimeout(n,750)},u=function(a){a.preventDefault();if(h.inStroke&&h.addToStroke(v(a))){clearTimeout(A);A=setTimeout(n,750)}},w=3*a.lineWidth;z=function(c){var b=c.x[0],c=c.y[0];i.fillStyle=a.color;i.fillRect(b+p,c+p,a.lineWidth,a.lineWidth);i.fillStyle=a["background-color"]};E=function(a,c){var b=new r(a.x[c-1],a.y[c-1]),d=new r(a.x[c],a.y[c]),g=b.getVectorToPoint(d);
if(c>1){var e=new r(a.x[c-2],a.y[c-2]),m=e.getVectorToPoint(b),k;if(m.getLength()>w){k=c>2?(new r(a.x[c-3],a.y[c-3])).getVectorToPoint(e):new l(0,0);var f=m.getLength()/2,h=(new l(k.x+m.x,k.y+m.y)).resizeTo(f),z=(new l(m.x+g.x,m.y+g.y)).reverse().resizeTo(f),m=e.x,f=e.y;k=b.x;var j=b.y,n=e.x+h.x,e=e.y+h.y,h=b.x+z.x,z=b.y+z.y;i.beginPath();i.moveTo(m,f);i.bezierCurveTo(n,e,h,z,k,j);i.stroke()}}g.getLength()<=w&&G(b.x,b.y,d.x,d.y)};F=function(a){var c=a.x.length-1;if(c>0){var b=new r(a.x[c],a.y[c]),
d=new r(a.x[c-1],a.y[c-1]),e=d.getVectorToPoint(b);if(e.getLength()>w)if(c>1){var a=(new r(a.x[c-2],a.y[c-2])).getVectorToPoint(d),g=(new l(a.x+e.x,a.y+e.y)).resizeTo(e.getLength()/2),e=d.x,a=d.y,c=b.x,m=b.y,k=d.x+g.x,d=d.y+g.y,g=b.x,b=b.y;i.beginPath();i.moveTo(e,a);i.bezierCurveTo(k,d,g,b,c,m);i.stroke()}else G(d.x,d.y,b.x,b.y)}};e?g.bind("mousedown.jSignature",function(a){g.unbind("mousedown.jSignature");t(a);g.bind("mousemove.jSignature",u);g.bind("mouseup.jSignature",n);g.bind("mousedown.jSignature",
t)}):(d.ontouchstart=function(c){d.onmousedown=null;B=a.lineWidth*-5<-15?a.lineWidth*-5:-15;t(c);d.ontouchend=n;d.ontouchstart=t;d.ontouchmove=u},d.onmousedown=function(a){d.ontouchstart=null;t(a);d.onmousedown=t;d.onmouseup=n;d.onmousemove=u});g.data("jSignature.reset",f);j(document).bind("mouseup.jSignature",n);f(a.data)},o={"default":function(){return this.toDataURL()},"native":function(b){return b},image:function(){var b=this.toDataURL();if("string"===typeof b&&4<b.length&&"data:"===b.slice(0,
5)&&-1!==b.indexOf(",")){var a=b.indexOf(",");return[b.slice(5,a),b.substr(a+1)]}return[]}},p={"native":function(b,a,f){f(b)}},h={init:function(b){return this.each(function(){D.call(this,b)})},reset:function(b){this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.reset")(b);return this},addPlugin:function(b,a,f){var c={"export":o,"import":p};c.hasOwnProperty(b)&&(c[b][a]=f);return this},listPlugins:function(b){var a={"export":o,"import":p},f=[];if(a.hasOwnProperty(b)){var b=
a[b],c;for(c in b)b.hasOwnProperty(c)&&f.push(c)}return f},getData:function(b){var a=this.find("canvas.jSignature").add(this.filter("canvas.jSignature"));void 0===b&&(b="default");if(0!==a.length&&o.hasOwnProperty(b))return o[b].call(a.get(0),a.data("jSignature.data"))},setData:function(b,a){var f=this.find("canvas.jSignature").add(this.filter("canvas.jSignature"));if(void 0===a&&"string"===typeof b&&(a=b.split(",")[0],a===b))return;0!==f.length&&p.hasOwnProperty(a)&&p[a].call(f.get(0),b,a,f.data("jSignature.reset"));
return this}};j.fn.jSignature=function(b){if(h[b])return h[b].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof b||!b)return h.init.apply(this,arguments);j.error("Method "+b+" does not exist on jQuery.jSignature")};return j})(this.jQuery)})("undefined"!==typeof window?window:this);/*

 ==============
 jSignature v2 jSignature's custom "base30" format export and import plugins.
 Copyright (c) 2011 Willow Systems Corp http://willow-systems.com
 MIT License <http://www.opensource.org/licenses/mit-license.php>
 ==============
*/
(function(){for(var j={},q={},l=29;-1<l;l--)j["0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[l]]="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[l+30],q["0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[l+30]]="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[l];var r=function(h){for(var h=h.split(""),b=h.length,a=1;a<b;a++)h[a]=j[h[a]];return h.join("")},C=function(h){for(var b=[],a=0,f=1,c=h.length,m,g,d=0;d<c;d++)m=h[d],g=m-a,a=m,0>g&&0<
f?(f=-1,b.push("Z")):0<g&&0>f&&(f=1,b.push("Y")),m=Math.abs(g),30<=m?b.push(r(m.toString(30))):b.push(m.toString(30));return b.join("")},D=function(h){for(var b=[],h=h.split(""),a=h.length,f,c=1,m=[],g=0,d=0;d<a;d++)(f=h[d],f in j||"Z"===f||"Y"===f)?(0!==m.length&&(m=parseInt(m.join(""),30)*c+g,b.push(m),g=m),"Z"===f)?(c=-1,m=[]):"Y"===f?(c=1,m=[]):m=[f]:m.push(q[f]);b.push(parseInt(m.join(""),30)*c+g);return b},o=function(h){for(var b=[],a=h.length,f,c=0;c<a;c++)f=h[c],b.push(C(f.x)),b.push(C(f.y));
return["image/jsignature;base30",b.join("_")]},p=function(h,b,a){if("string"===typeof h){"image/jsignature;base30"===h.substring(0,23).toLowerCase()&&(h=h.substring(24));for(var b=[],h=h.split("_"),f=h.length/2,c=0;c<f;c++)b.push({x:D(h[2*c]),y:D(h[2*c+1])});a(b)}};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(h){h=h.fn.jSignature;h("addPlugin","export","base30",o);h("addPlugin","export","image/jsignature;base30",
o);h("addPlugin","import","base30",p);h("addPlugin","import","image/jsignature;base30",p)})(this.jQuery)}).call("undefined"!==typeof window?window:this);/*

 ==============
 Simplify.js BSD 
 (c) 2012, Vladimir Agafonkin
 mourner.github.com/simplify-js
 ==============

 ====================================================================
 base64 encoder
 MIT, GPL

 version: 1109.2015
 discuss at: http://phpjs.org/functions/base64_encode
 +   original by: Tyler Akins (http://rumkin.com)
 +   improved by: Bayron Guevara
 +   improved by: Thunder.m
 +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
 +   bugfixed by: Pellentesque Malesuada
 +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
 +   improved by: Rafal Kukawski (http://kukawski.pl)
 ====================================================================

 ==============
 jSignature v2 SVG export plugin.
 Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
 MIT License <http://www.opensource.org/licenses/mit-license.php>
 ============== 
*/
(function(){function j(a,b){this.x=a;this.y=b;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var g=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=a,this.y=a*g(this.y);else if(0===this.y)this._length=a,this.x=a*g(this.x);else{var c=Math.abs(this.y/
this.x),b=Math.sqrt(Math.pow(a,2)/(1+Math.pow(c,2))),c=c*b;this._length=a;this.x=b*g(this.x);this.y=c*g(this.y)}return this};this.angleTo=function(a){var c=this.getLength()*a.getLength();return 0===c?0:Math.acos(Math.min(Math.max((this.x*a.x+this.y*a.y)/c,-1),1))/Math.PI}}function q(a,b){this.x=a;this.y=b;this.getVectorToCoordinates=function(a,c){return new j(a-this.x,c-this.y)};this.getVectorFromCoordinates=function(a,c){return this.getVectorToCoordinates(a,c).reverse()};this.getVectorToPoint=function(a){return new j(a.x-
this.x,a.y-this.y)};this.getVectorFromPoint=function(a){return this.getVectorToPoint(a).reverse()}}function l(a,b){var g=Math.pow(10,b);return Math.round(a*g)/g}function r(a,b,g){var b=b+1,d=new q(a.x[b-1],a.y[b-1]),e=new q(a.x[b],a.y[b]),e=d.getVectorToPoint(e),k=new q(a.x[b-2],a.y[b-2]),d=k.getVectorToPoint(d);if(d.getLength()>g){var a=2<b?(new q(a.x[b-3],a.y[b-3])).getVectorToPoint(k):new j(0,0),i=0.35*d.getLength(),g=d.angleTo(a.reverse()),b=e.angleTo(d.reverse()),a=(new j(a.x+d.x,a.y+d.y)).resizeTo(Math.max(0.05,
g)*i),e=(new j(d.x+e.x,d.y+e.y)).reverse().resizeTo(Math.max(0.05,b)*i),e=new j(d.x+e.x,d.y+e.y),i=2;return["c",l(a.x,i),l(a.y,i),l(e.x,i),l(e.y,i),l(d.x,i),l(d.y,i)]}return["l",l(d.x,i),l(d.y,i)]}function C(a,b){var g=a.x.length-1,d=new q(a.x[g],a.y[g]),e=new q(a.x[g-1],a.y[g-1]),d=e.getVectorToPoint(d);if(1<g&&d.getLength()>b){var k=(new q(a.x[g-2],a.y[g-2])).getVectorToPoint(e),g=d.angleTo(k.reverse()),e=0.35*d.getLength(),g=(new j(k.x+d.x,k.y+d.y)).resizeTo(Math.max(0.05,g)*e),k=2;return["c",
l(g.x,k),l(g.y,k),l(d.x,k),l(d.y,k),l(d.x,k),l(d.y,k)]}return["l",l(d.x,k),l(d.y,k)]}function D(a,b,g){for(var b=["M",x=a.x[0]-b,y=a.y[0]-g],g=1,d=a.x.length-1;g<d;g++)b.push.apply(b,r(a,g,1));0<d&&b.push.apply(b,C(a,g,1));return b.join(" ")}function o(a){var b=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>'],g,d=a.length,e,k=[],i=[],f=e=g=0,h=0,l=[];if(0!==d){for(g=0;g<d;g++){f=a[g];h=[];e={x:[],y:[]};for(var j=void 0,s=void 0,j=0,s=f.x.length;j<s;j++)h.push({x:f.x[j],y:f.y[j]});h=simplify(h,
0.7,!0);j=0;for(s=h.length;j<s;j++)e.x.push(h[j].x),e.y.push(h[j].y);l.push(e);k=k.concat(e.x);i=i.concat(e.y)}a=Math.min.apply(null,k)-1;d=Math.max.apply(null,k)+1;k=Math.min.apply(null,i)-1;i=Math.max.apply(null,i)+1;f=0>a?0:a;h=0>k?0:k;g=d-a;e=i-k}b.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+g.toString()+'" height="'+e.toString()+'">');b.push('<style type="text/css"><![CDATA[.f {fill:none;stroke:#000000;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}]]\></style>');
g=0;for(d=l.length;g<d;g++)e=l[g],b.push('<path class="f" d="'+D(e,f,h)+'"/>');b.push("</svg>");return b.join("")}function p(b){return[a,o(b)]}function h(a){return[f,b(o(a))]}(function(a,b){"use strict";(typeof exports!=b+""?exports:a).simplify=function(a,c,e){c=c!==b?c*c:1;if(!e){for(var f=a.length,i,h=a[0],l=[h],e=1;e<f;e++){i=a[e];var j=i.x-h.x,o=i.y-h.y;j*j+o*o>c&&(l.push(i),h=i)}a=(h!==i&&l.push(i),l)}i=a;var e=i.length,f=new (typeof Uint8Array!=b+""?Uint8Array:Array)(e),h=0,l=e-1,s,p,q=[],r=
[],A=[];for(f[h]=f[l]=1;l;){o=0;for(j=h+1;j<l;j++){s=i[j];var n=i[h],B=i[l],v=n.x,t=n.y,n=B.x-v,u=B.y-t,w=void 0;if(0!==n||0!==u)w=((s.x-v)*n+(s.y-t)*u)/(n*n+u*u),1<w?(v=B.x,t=B.y):0<w&&(v+=n*w,t+=u*w);s=(n=s.x-v,u=s.y-t,n*n+u*u);s>o&&(p=j,o=s)}o>c&&(f[p]=1,q.push(h),r.push(p),q.push(p),r.push(l));h=q.pop();l=r.pop()}for(j=0;j<e;j++)f[j]&&A.push(i[j]);return a=A,a}})(this);if("function"!==typeof b)var b=function(a){var b="A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,0,1,2,3,4,5,6,7,8,9,+,/,=".split(","),
g,d,e,f,h=0,l=0,j="",j=[];do g=a.charCodeAt(h++),d=a.charCodeAt(h++),e=a.charCodeAt(h++),f=g<<16|d<<8|e,g=f>>18&63,d=f>>12&63,e=f>>6&63,f&=63,j[l++]=b[g]+b[d]+b[e]+b[f];while(h<a.length);j=j.join("");a=a.length%3;return(a?j.slice(0,a-3):j)+"===".slice(a||3)};var a="image/svg+xml",f="image/svg+xml;base64";if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(b){b=b.fn.jSignature;b("addPlugin","export","svg",p);b("addPlugin",
"export",a,p);b("addPlugin","export","svgbase64",h);b("addPlugin","export",f,h)})(this.jQuery)}).call("undefined"!==typeof window?window:this);
