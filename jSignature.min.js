/*

 jSignature v2

 Copyright (c) 2011 Willow Systems Corp http://willow-systems.com
 Copyright (c) 2010 Brinley Ang http://www.unbolt.net

 MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
(function(){var t=function(l){function p(b){for(var a,d=b.css("color"),f;void 0===f&&void 0!==b;){try{a=b.css("background-color")}catch(c){a="transparent"}"transparent"!==a&&"rgba(0, 0, 0, 0)"!==a&&(f=a);try{b=b.parent(),b[0]===document&&(b=void 0)}catch(i){b=void 0}}var b=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,g=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,e;a=void 0;(a=d.match(b))?e={r:parseInt(a[1],10),g:parseInt(a[2],10),b:parseInt(a[3],10)}:(a=d.match(g))&&(e={r:parseInt(a[1],
16),g:parseInt(a[2],16),b:parseInt(a[3],16)});var k;f?(a=void 0,(a=f.match(b))?k={r:parseInt(a[1],10),g:parseInt(a[2],10),b:parseInt(a[3],10)}:(a=f.match(g))&&(k={r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)})):k=e?127<Math.max.apply(null,[e.r,e.g,e.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255}:{r:255,g:255,b:255};a=function(a){return"rgb("+[a.r,a.g,a.b].join(", ")+")"};e&&k?(b=Math.max.apply(null,[e.r,e.g,e.b]),e=Math.max.apply(null,[k.r,k.g,k.b]),e=Math.round(e+-0.75*(e-b)),e={r:e,g:e,b:e}):
e?(e=Math.max.apply(null,[e.r,e.g,e.b]),b=1,127<e&&(b=-1),e=Math.round(e+96*b),e={r:e,g:e,b:e}):e={r:191,g:191,b:191};return{color:d,"background-color":k?a(k):f,"decor-color":a(e)}}function q(b,a){this.x=b;this.y=a;this.reverse=function(){this.x*=-1;this.y*=-1;return this};this._length=null;this.getLength=function(){if(!this._length)this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2));return this._length};var d=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===
this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=a,this.y=a*d(this.y);else if(0===this.y)this._length=a,this.x=a*d(this.x);else{var b=Math.abs(this.y/this.x),c=Math.sqrt(Math.pow(a,2)/(1+Math.pow(b,2))),b=b*c;this._length=a;this.x=c*d(this.x);this.y=b*d(this.y)}return this}}function o(b,a){this.x=b;this.y=a;this.getVectorToCoordinates=function(a,b){return new q(a-this.x,b-this.y)};this.getVectorFromCoordinates=function(a,b){return this.getVectorToCoordinates(a,b).reverse()};this.getVectorToPoint=
function(a){return new q(a.x-this.x,a.y-this.y)};this.getVectorFromPoint=function(a){return this.getVectorToPoint(a).reverse()}}function t(b){this._storageObject=b;this.startStrokeFn=function(){};this.addToStrokeFn=function(){};this.endStrokeFn=function(){};this.inStroke=!1;this._stroke=this._lastPoint=null;this.startStroke=function(a){if(a&&"number"==typeof a.x&&"number"==typeof a.y){this._stroke={x:[a.x],y:[a.y]};this._storageObject.push(this._stroke);this._lastPoint=a;this.inStroke=!0;var b=this._stroke,
c=this.startStrokeFn;setTimeout(function(){c(b)},3);return a}return null};this.addToStroke=function(a){if(this.inStroke&&"number"===typeof a.x&&"number"===typeof a.y&&2<Math.abs(a.x-this._lastPoint.x)+Math.abs(a.y-this._lastPoint.y)){var b=this._stroke.x.length;this._stroke.x.push(a.x);this._stroke.y.push(a.y);this._lastPoint=a;var c=this._stroke,j=this.addToStrokeFn;setTimeout(function(){j(c,b)},3);return a}return null};this.endStroke=function(){var a=this.inStroke;this.inStroke=!1;this._lastPoint=
null;if(a){var b=this.endStrokeFn,c=this._stroke;setTimeout(function(){b(c)},3);return!0}return null}}var s=function(b){var a={width:"max",height:"max",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0},c=l(this);l.extend(a,p(c));b&&l.extend(a,b);if("max"==a.width||"max"==a.height){var b=c.width(),f=c.height();b/a.sizeRatio>f&&(f=parseInt(b/a.sizeRatio,10));a.width=b;a.height=f}if(0==a.lineWidth)b=parseInt(a.width,10),b=parseInt(b/300,10),a.lineWidth=2>b?2:b;var j=
1E3>parseInt(a.width,10)?!0:!1,i=c.find("canvas"),g;i.length?g=i.get(0):(g=document.createElement("canvas"),g.width=a.width,g.height=a.height,i=l(g),i.appendTo(c));i.addClass("jSignature");var e=!1,k=1;g.getContext||("undefined"!==typeof FlashCanvas?(window&&window.screen&&window.screen.deviceXDPI&&window.screen.logicalXDPI&&(k=window.screen.deviceXDPI/window.screen.logicalXDPI),g=FlashCanvas.initElement(g),1!=k&&i.children("object").get(0).resize(Math.ceil(g.width*k),Math.ceil(g.height*k)),e=!0):
"undefined"!=typeof G_vmlCanvasManager&&(g=G_vmlCanvasManager.initElement(g),e=!0));if(!g.getContext)throw Error("Canvas element does not support 2d context. jSignature cannot proceed.");g.onselectstart=function(a){a&&a.preventDefault&&a.preventDefault();a&&a.stopPropagation&&a.stopPropagation();return!1};a.cssclass&&""!=l.trim(a.cssclass)&&i.addClass(a.cssclass);var h=g.getContext("2d"),r,m,n,s,E,F,G=-1*Math.round(a.lineWidth/2),x=function(a,b,c,g){h.beginPath();h.moveTo(a,b);h.lineTo(c,g);h.stroke()},
c=function(b){var c=g.width,d=g.height;h.clearRect(0,0,c*k+30,d*k+30);h.shadowColor=h.fillStyle=a["background-color"];e&&h.fillRect(0,0,c*k+30,d*k+30);h.lineWidth=Math.ceil(parseInt(a.lineWidth,10)*k);h.lineCap=h.lineJoin="round";var f=Math.round(d/5);h.strokeStyle=a["decor-color"];h.shadowOffsetX=0;h.shadowOffsetY=0;x(1.5*f,d-f,c-1.5*f,d-f);h.strokeStyle=a.color;if(!e&&!j)h.shadowColor=h.strokeStyle,h.shadowOffsetX=0.5*h.lineWidth,h.shadowOffsetY=-0.6*h.lineWidth,h.shadowBlur=0;if(void 0===b)b=[];
else for(var c=b.length,y=0;y<c;y++){d=b[y];f=d.x.length;m(d);for(var z=1;z<f;z++)n(d,z);s(d)}r=new t(b);r.startStrokeFn=m;r.addToStrokeFn=n;r.endStrokeFn=s;i.data("jSignature.data",b);return!0},w=null,u=function(a){try{a.preventDefault()}catch(b){}clearTimeout(w);r.endStroke()},A=function(){var a=l(g).offset();E=-1*a.left;F=-1*a.top},H=0,I=function(a){a=a.changedTouches&&0<a.changedTouches.length?a.changedTouches[0]:a;return new o(Math.round((a.pageX+E)*k),Math.round((a.pageY+F)*k)+H)},v=function(a){a.preventDefault();
r.startStroke(I(a));clearTimeout(w);w=setTimeout(u,750)},B=function(a){a.preventDefault();r.inStroke&&r.addToStroke(I(a))&&(clearTimeout(w),w=setTimeout(u,750))},C=3*a.lineWidth;m=function(b){var c=b.x[0],b=b.y[0];h.fillStyle=a.color;h.fillRect(c+G,b+G,a.lineWidth,a.lineWidth);h.fillStyle=a["background-color"]};n=function(a,b){var c=new o(a.x[b-1],a.y[b-1]),d=new o(a.x[b],a.y[b]),g=c.getVectorToPoint(d);if(1<b){var e=new o(a.x[b-2],a.y[b-2]),f=e.getVectorToPoint(c),i;if(f.getLength()>C){i=2<b?(new o(a.x[b-
3],a.y[b-3])).getVectorToPoint(e):new q(0,0);var j=f.getLength()/2,k=(new q(i.x+f.x,i.y+f.y)).resizeTo(j),l=(new q(f.x+g.x,f.y+g.y)).reverse().resizeTo(j),f=e.x,j=e.y;i=c.x;var m=c.y,n=e.x+k.x,e=e.y+k.y,k=c.x+l.x,l=c.y+l.y;h.beginPath();h.moveTo(f,j);h.bezierCurveTo(n,e,k,l,i,m);h.stroke()}}g.getLength()<=C&&x(c.x,c.y,d.x,d.y)};s=function(a){var b=a.x.length-1;if(0<b){var c=new o(a.x[b],a.y[b]),d=new o(a.x[b-1],a.y[b-1]),e=d.getVectorToPoint(c);if(e.getLength()>C)if(1<b){var a=(new o(a.x[b-2],a.y[b-
2])).getVectorToPoint(d),f=(new q(a.x+e.x,a.y+e.y)).resizeTo(e.getLength()/2),e=d.x,a=d.y,b=c.x,g=c.y,i=d.x+f.x,d=d.y+f.y,f=c.x,c=c.y;h.beginPath();h.moveTo(e,a);h.bezierCurveTo(i,d,f,c,b,g);h.stroke()}else x(d.x,d.y,c.x,c.y)}};e?i.bind("mousedown.jSignature",function(a){A();i.unbind("mousedown.jSignature");i.bind("mousedown.jSignature",v);i.bind("mouseup.jSignature",u);v(a);i.bind("mousemove.jSignature",B)}):(g.ontouchstart=function(b){g.onmousedown=null;H=-15>-5*a.lineWidth?-5*a.lineWidth:-15;A();
g.ontouchstart=v;g.ontouchend=u;g.ontouchmove=B;v(b)},g.onmousedown=function(a){g.ontouchstart=null;A();g.onmousedown=v;g.onmouseup=u;g.onmousemove=B;v(a)});i.data("jSignature.reset",c);l(document).bind("mouseup.jSignature",u);c(a.data)},m={"default":function(b){return b},"native":function(b){return b},image:function(){return this.toDataURL()}},n={"default":function(b,a,c){c(b)}},c={init:function(b){return this.each(function(){s.call(this,b)})},reset:function(b){this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.reset")(b);
return this},addPlugin:function(b,a,c){var f={"export":m,"import":n};f.hasOwnProperty(b)&&(f[b][a]=c);return this},getData:function(b){var a=this.find("canvas.jSignature").add(this.filter("canvas.jSignature"));void 0===b&&(b="default");if(0!==a.length&&m.hasOwnProperty(b))return m[b].call(a.get(0),a.data("jSignature.data"))},setData:function(b,a){var c=this.find("canvas.jSignature").add(this.filter("canvas.jSignature"));if(void 0===a&&"string"===typeof b&&(a=b.split(",")[0],a===b))return;0!==c.length&&
n.hasOwnProperty(a)&&n[a].call(c.get(0),b,a,c.data("jSignature.reset"));return this}};l.fn.jSignature=function(b){if(c[b])return c[b].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof b||!b)return c.init.apply(this,arguments);l.error("Method "+b+" does not exist on jQuery.jSignature")};return l};if("function"===typeof define&&null!=define.amd)define(function(){return t});else{if(void 0===this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");
t(this.jQuery)}})("undefined"!==typeof window?window:this);(function(){for(var t={},l={},p=29;-1<p;p--)t["0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[p]]="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[p+30],l["0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[p+30]]="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[p];var q=function(c){for(var c=c.split(""),b=c.length,a=1;a<b;a++)c[a]=t[c[a]];return c.join("")},o=function(c){for(var b=[],a=0,d=1,f=c.length,j,i,g=0;g<f;g++)j=c[g],i=j-a,a=j,0>i&&0<
d?(d=-1,b.push("Z")):0<i&&0>d&&(d=1,b.push("Y")),j=Math.abs(i),30<=j?b.push(q(j.toString(30))):b.push(j.toString(30));return b.join("")},D=function(c){for(var b=[],c=c.split(""),a=c.length,d,f=1,j=[],i=0,g=0;g<a;g++)d=c[g],d in t||"Z"===d||"Y"===d?(0!==j.length&&(j=parseInt(j.join(""),30)*f+i,b.push(j),i=j),"Z"===d?(f=-1,j=[]):"Y"===d?(f=1,j=[]):j=[d]):j.push(l[d]);b.push(parseInt(j.join(""),30)*f+i);return b},s=function(c){for(var b=[],a=c.length,d,f=0;f<a;f++)d=c[f],b.push(o(d.x)),b.push(o(d.y));
return["image/jsignature;base30",b.join("_")]},m=function(c,b,a){if("string"===typeof c){"image/jsignature;base30"===c.substring(0,23).toLowerCase()&&(c=c.substring(24));for(var b=[],c=c.split("_"),d=c.length/2,f=0;f<d;f++)b.push({x:D(c[2*f]),y:D(c[2*f+1])});a(b)}},n=function(c){c=c.fn.jSignature;c("addPlugin","export","base30",s);c("addPlugin","export","image/jsignature;base30",s);c("addPlugin","import","base30",m);c("addPlugin","import","image/jsignature;base30",m)};if("function"===typeof define&&
null!=define.amd)define(function(){return n});else{if(void 0===this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");n(this.jQuery)}}).call("undefined"!==typeof window?window:this);
