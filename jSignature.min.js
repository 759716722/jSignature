/*

 jSignature v2

 Copyright (c) 2011 Willow Systems Corp http://willow-systems.com
 Copyright (c) 2010 Brinley Ang http://www.unbolt.net

 MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
(function(){if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(o){function q(b){for(var a,g=b.css("color"),j;void 0===j&&void 0!==b;){try{a=b.css("background-color")}catch(c){a="transparent"}"transparent"!==a&&"rgba(0, 0, 0, 0)"!==a&&(j=a);try{b=b.parent(),b[0]===document&&(b=void 0)}catch(i){b=void 0}}var b=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,h=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,
f;a=void 0;(a=g.match(b))?f={r:parseInt(a[1],10),g:parseInt(a[2],10),b:parseInt(a[3],10)}:(a=g.match(h))&&(f={r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)});var d;j?(a=void 0,(a=j.match(b))?d={r:parseInt(a[1],10),g:parseInt(a[2],10),b:parseInt(a[3],10)}:(a=j.match(h))&&(d={r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)})):d=f?127<Math.max.apply(null,[f.r,f.g,f.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255}:{r:255,g:255,b:255};a=function(a){return"rgb("+[a.r,a.g,a.b].join(", ")+
")"};f&&d?(b=Math.max.apply(null,[f.r,f.g,f.b]),f=Math.max.apply(null,[d.r,d.g,d.b]),f=Math.round(f+-0.75*(f-b)),f={r:f,g:f,b:f}):f?(f=Math.max.apply(null,[f.r,f.g,f.b]),b=1,127<f&&(b=-1),f=Math.round(f+96*b),f={r:f,g:f,b:f}):f={r:191,g:191,b:191};return{color:g,"background-color":d?a(d):j,"decor-color":a(f)}}function d(b,a){this.x=b;this.y=a;this.reverse=function(){this.x*=-1;this.y*=-1;return this};this._length=null;this.getLength=function(){if(!this._length)this._length=Math.sqrt(Math.pow(this.x,
2)+Math.pow(this.y,2));return this._length};var g=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=a,this.y=a*g(this.y);else if(0===this.y)this._length=a,this.x=a*g(this.x);else{var b=Math.abs(this.y/this.x),c=Math.sqrt(Math.pow(a,2)/(1+Math.pow(b,2))),b=b*c;this._length=a;this.x=c*g(this.x);this.y=b*g(this.y)}return this}}function n(b,a){this.x=b;this.y=a;this.getVectorToCoordinates=function(a,b){return new d(a-
this.x,b-this.y)};this.getVectorFromCoordinates=function(a,b){return this.getVectorToCoordinates(a,b).reverse()};this.getVectorToPoint=function(a){return new d(a.x-this.x,a.y-this.y)};this.getVectorFromPoint=function(a){return this.getVectorToPoint(a).reverse()}}function i(b){this._storageObject=b;this.startStrokeFn=function(){};this.addToStrokeFn=function(){};this.endStrokeFn=function(){};this.inStroke=!1;this._stroke=this._lastPoint=null;this.startStroke=function(a){if(a&&"number"==typeof a.x&&
"number"==typeof a.y){this._stroke={x:[a.x],y:[a.y]};this._storageObject.push(this._stroke);this._lastPoint=a;this.inStroke=!0;var b=this._stroke,c=this.startStrokeFn;setTimeout(function(){c(b)},3);return a}return null};this.addToStroke=function(a){if(this.inStroke&&"number"===typeof a.x&&"number"===typeof a.y&&2<Math.abs(a.x-this._lastPoint.x)+Math.abs(a.y-this._lastPoint.y)){var b=this._stroke.x.length;this._stroke.x.push(a.x);this._stroke.y.push(a.y);this._lastPoint=a;var c=this._stroke,d=this.addToStrokeFn;
setTimeout(function(){d(c,b)},3);return a}return null};this.endStroke=function(){var a=this.inStroke;this.inStroke=!1;this._lastPoint=null;if(a){var b=this.endStrokeFn,c=this._stroke;setTimeout(function(){b(c)},3);return!0}return null}}var m=function(b){var a={width:"max",height:"max",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0},c=o(this);o.extend(a,q(c));b&&o.extend(a,b);if("max"==a.width||"max"==a.height){var b=c.width(),j=c.height();b/a.sizeRatio>j&&(j=parseInt(b/
a.sizeRatio,10));a.width=b;a.height=j}if(0==a.lineWidth)b=parseInt(a.width,10),b=parseInt(b/300,10),a.lineWidth=2>b?2:b;var l=1E3>parseInt(a.width,10)?!0:!1,p=c.find("canvas"),h;p.length?h=p.get(0):(h=document.createElement("canvas"),h.width=a.width,h.height=a.height,p=o(h),p.appendTo(c));p.addClass("jSignature");var f=!1,e=1;h.getContext||("undefined"!==typeof FlashCanvas?(window&&window.screen&&window.screen.deviceXDPI&&window.screen.logicalXDPI&&(e=window.screen.deviceXDPI/window.screen.logicalXDPI),
h=FlashCanvas.initElement(h),1!=e&&p.children("object").get(0).resize(Math.ceil(h.width*e),Math.ceil(h.height*e)),f=!0):"undefined"!=typeof G_vmlCanvasManager&&(h=G_vmlCanvasManager.initElement(h),f=!0));if(!h.getContext)throw Error("Canvas element does not support 2d context. jSignature cannot proceed.");h.onselectstart=function(a){a&&a.preventDefault&&a.preventDefault();a&&a.stopPropagation&&a.stopPropagation();return!1};a.cssclass&&""!=o.trim(a.cssclass)&&p.addClass(a.cssclass);var k=h.getContext("2d"),
m,u,v,w,B,C,D=-1*Math.round(a.lineWidth/2),x=function(a,b,c,g){k.beginPath();k.moveTo(a,b);k.lineTo(c,g);k.stroke()},c=function(b){var c=h.width,g=h.height;k.clearRect(0,0,c*e+30,g*e+30);k.shadowColor=k.fillStyle=a["background-color"];f&&k.fillRect(0,0,c*e+30,g*e+30);k.lineWidth=Math.ceil(parseInt(a.lineWidth,10)*e);k.lineCap=k.lineJoin="round";var d=Math.round(g/5);k.strokeStyle=a["decor-color"];k.shadowOffsetX=0;k.shadowOffsetY=0;x(1.5*d,g-d,c-1.5*d,g-d);k.strokeStyle=a.color;if(!f&&!l)k.shadowColor=
k.strokeStyle,k.shadowOffsetX=0.5*k.lineWidth,k.shadowOffsetY=-0.6*k.lineWidth,k.shadowBlur=0;if(void 0===b)b=[];else for(var c=b.length,j=0;j<c;j++){g=b[j];d=g.x.length;u(g);for(var n=1;n<d;n++)v(g,n);w(g)}m=new i(b);m.startStrokeFn=u;m.addToStrokeFn=v;m.endStrokeFn=w;p.data("jSignature.data",b);return!0},t=null,r=function(a){try{a.preventDefault()}catch(b){}clearTimeout(t);m.endStroke()},y=function(){var a=o(h).offset();B=-1*a.left;C=-1*a.top},E=0,F=function(a){a=a.changedTouches&&0<a.changedTouches.length?
a.changedTouches[0]:a;return new n(Math.round((a.pageX+B)*e),Math.round((a.pageY+C)*e)+E)},s=function(a){a.preventDefault();m.startStroke(F(a));clearTimeout(t);t=setTimeout(r,750)},z=function(a){a.preventDefault();m.inStroke&&m.addToStroke(F(a))&&(clearTimeout(t),t=setTimeout(r,750))},A=3*a.lineWidth;u=function(b){var c=b.x[0],b=b.y[0];k.fillStyle=a.color;k.fillRect(c+D,b+D,a.lineWidth,a.lineWidth);k.fillStyle=a["background-color"]};v=function(a,b){var c=new n(a.x[b-1],a.y[b-1]),g=new n(a.x[b],a.y[b]),
h=c.getVectorToPoint(g);if(1<b){var f=new n(a.x[b-2],a.y[b-2]),j=f.getVectorToPoint(c),e;if(j.getLength()>A){e=2<b?(new n(a.x[b-3],a.y[b-3])).getVectorToPoint(f):new d(0,0);var i=j.getLength()/2,l=(new d(e.x+j.x,e.y+j.y)).resizeTo(i),m=(new d(j.x+h.x,j.y+h.y)).reverse().resizeTo(i),j=f.x,i=f.y;e=c.x;var p=c.y,G=f.x+l.x,f=f.y+l.y,l=c.x+m.x,m=c.y+m.y;k.beginPath();k.moveTo(j,i);k.bezierCurveTo(G,f,l,m,e,p);k.stroke()}}h.getLength()<=A&&x(c.x,c.y,g.x,g.y)};w=function(a){var b=a.x.length-1;if(0<b){var c=
new n(a.x[b],a.y[b]),g=new n(a.x[b-1],a.y[b-1]),f=g.getVectorToPoint(c);if(f.getLength()>A)if(1<b){var a=(new n(a.x[b-2],a.y[b-2])).getVectorToPoint(g),j=(new d(a.x+f.x,a.y+f.y)).resizeTo(f.getLength()/2),f=g.x,a=g.y,b=c.x,h=c.y,e=g.x+j.x,g=g.y+j.y,j=c.x,c=c.y;k.beginPath();k.moveTo(f,a);k.bezierCurveTo(e,g,j,c,b,h);k.stroke()}else x(g.x,g.y,c.x,c.y)}};f?p.bind("mousedown.jSignature",function(a){y();p.unbind("mousedown.jSignature");p.bind("mousedown.jSignature",s);p.bind("mouseup.jSignature",r);s(a);
p.bind("mousemove.jSignature",z)}):(h.ontouchstart=function(b){h.onmousedown=null;E=-15>-5*a.lineWidth?-5*a.lineWidth:-15;y();h.ontouchstart=s;h.ontouchend=r;h.ontouchmove=z;s(b)},h.onmousedown=function(a){h.ontouchstart=null;y();h.onmousedown=s;h.onmouseup=r;h.onmousemove=z;s(a)});p.data("jSignature.reset",c);o(document).bind("mouseup.jSignature",r);c(a.data)},l={"default":function(b){return b},"native":function(b){return b},image:function(){var b=this.toDataURL();if("string"===typeof b&&4<b.length&&
"data:"===b.slice(0,5)&&-1!==b.indexOf(",")){var a=b.indexOf(",");return[b.slice(5,a),b.substr(a+1)]}return[]}},e={"default":function(b,a,c){c(b)}},c={init:function(b){return this.each(function(){m.call(this,b)})},reset:function(b){this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.reset")(b);return this},addPlugin:function(b,a,c){var j={"export":l,"import":e};j.hasOwnProperty(b)&&(j[b][a]=c);return this},listPlugins:function(b){var a={"export":l,"import":e},c=[];
if(a.hasOwnProperty(b)){var b=a[b],j;for(j in b)b.hasOwnProperty(j)&&c.push(j)}return c},getData:function(b){var a=this.find("canvas.jSignature").add(this.filter("canvas.jSignature"));void 0===b&&(b="default");if(0!==a.length&&l.hasOwnProperty(b))return l[b].call(a.get(0),a.data("jSignature.data"))},setData:function(b,a){var c=this.find("canvas.jSignature").add(this.filter("canvas.jSignature"));if(void 0===a&&"string"===typeof b&&(a=b.split(",")[0],a===b))return;0!==c.length&&e.hasOwnProperty(a)&&
e[a].call(c.get(0),b,a,c.data("jSignature.reset"));return this}};o.fn.jSignature=function(b){if(c[b])return c[b].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof b||!b)return c.init.apply(this,arguments);o.error("Method "+b+" does not exist on jQuery.jSignature")};return o})(this.jQuery)})("undefined"!==typeof window?window:this);/*

 jSignature v2 jSignature's custom "base30" export and import plugins.

 Copyright (c) 2011 Willow Systems Corp http://willow-systems.com

 MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
(function(){for(var o={},q={},d=29;-1<d;d--)o["0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[d]]="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[d+30],q["0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[d+30]]="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[d];var n=function(c){for(var c=c.split(""),b=c.length,a=1;a<b;a++)c[a]=o[c[a]];return c.join("")},i=function(c){for(var b=[],a=0,g=1,j=c.length,d,e,h=0;h<j;h++)d=c[h],e=d-a,a=d,0>e&&0<
g?(g=-1,b.push("Z")):0<e&&0>g&&(g=1,b.push("Y")),d=Math.abs(e),30<=d?b.push(n(d.toString(30))):b.push(d.toString(30));return b.join("")},m=function(c){for(var b=[],c=c.split(""),a=c.length,g,d=1,e=[],i=0,h=0;h<a;h++)g=c[h],g in o||"Z"===g||"Y"===g?(0!==e.length&&(e=parseInt(e.join(""),30)*d+i,b.push(e),i=e),"Z"===g?(d=-1,e=[]):"Y"===g?(d=1,e=[]):e=[g]):e.push(q[g]);b.push(parseInt(e.join(""),30)*d+i);return b},l=function(c){for(var b=[],a=c.length,d,e=0;e<a;e++)d=c[e],b.push(i(d.x)),b.push(i(d.y));
return["image/jsignature;base30",b.join("_")]},e=function(c,b,a){if("string"===typeof c){"image/jsignature;base30"===c.substring(0,23).toLowerCase()&&(c=c.substring(24));for(var b=[],c=c.split("_"),d=c.length/2,e=0;e<d;e++)b.push({x:m(c[2*e]),y:m(c[2*e+1])});a(b)}};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(c){c=c.fn.jSignature;c("addPlugin","export","base30",l);c("addPlugin","export","image/jsignature;base30",
l);c("addPlugin","import","base30",e);c("addPlugin","import","image/jsignature;base30",e)})(this.jQuery)}).call("undefined"!==typeof window?window:this);/*

 jSignature v2 SVG export plugin.

 Copyright (c) 2011 Willow Systems Corp http://willow-systems.com

 MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
(function(){var o=function(d,n,i,m){var l=d[0],e=n[0],c=d.length,m=["M",l-i,e-m,"l"];if(1===c)m.concat(1,-1);else for(i=1;i<c;i++)m=m.concat(d[i]-l,n[i]-e),l=d[i],e=n[i];return m.join(" ")},q=function(d){var n=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>'],i,m=d.length,l,e=[],c=[],b=l=i=0,a=0;if(0!==m){for(i=0;i<m;i++)l=d[i],e=e.concat(l.x),c=c.concat(l.y);i=Math.min.apply(null,e)-1;l=Math.max.apply(null,e)+1;e=Math.min.apply(null,c)-1;c=Math.max.apply(null,c)+1;b=0>i?0:i;a=0>e?0:e;i=
l-i;l=c-e}n.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+i.toString()+'" height="'+l.toString()+'">');for(i=0;i<m;i++)l=d[i],n.push('<path style="fill:none;stroke:#000000;" d="'+o(l.x,l.y,b,a)+'"/>');n.push("</svg>");return["image/svg+xml",n.join("")]};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(d){d=d.fn.jSignature;d("addPlugin","export","svg",q);d("addPlugin","export","image/svg+xml",
q)})(this.jQuery)}).call("undefined"!==typeof window?window:this);
