/*

 jSignature v2

 Copyright (c) 2011 Willow Systems Corp http://willow-systems.com
 Copyright (c) 2010 Brinley Ang http://www.unbolt.net

 MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
(function(){if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(f){function n(a){for(var b,c=a.css("color"),i;void 0===i&&void 0!==a;){try{b=a.css("background-color")}catch(d){b="transparent"}"transparent"!==b&&"rgba(0, 0, 0, 0)"!==b&&(i=b);try{a=a.parent(),a[0]===document&&(a=void 0)}catch(e){a=void 0}}var a=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,g=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,
h;b=void 0;(b=c.match(a))?h={r:parseInt(b[1],10),g:parseInt(b[2],10),b:parseInt(b[3],10)}:(b=c.match(g))&&(h={r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)});var f;i?(b=void 0,(b=i.match(a))?f={r:parseInt(b[1],10),g:parseInt(b[2],10),b:parseInt(b[3],10)}:(b=i.match(g))&&(f={r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)})):f=h?127<Math.max.apply(null,[h.r,h.g,h.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255}:{r:255,g:255,b:255};b=function(a){return"rgb("+[a.r,a.g,a.b].join(", ")+
")"};h&&f?(a=Math.max.apply(null,[h.r,h.g,h.b]),h=Math.max.apply(null,[f.r,f.g,f.b]),h=Math.round(h+-0.75*(h-a)),h={r:h,g:h,b:h}):h?(h=Math.max.apply(null,[h.r,h.g,h.b]),a=1,127<h&&(a=-1),h=Math.round(h+96*a),h={r:h,g:h,b:h}):h={r:191,g:191,b:191};return{color:c,"background-color":f?b(f):i,"decor-color":b(h)}}function l(a,b){this.x=a;this.y=b;this.reverse=function(){this.x*=-1;this.y*=-1;return this};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,
2)+Math.pow(this.y,2)));return this._length};var c=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=a,this.y=a*c(this.y);else if(0===this.y)this._length=a,this.x=a*c(this.x);else{var b=Math.abs(this.y/this.x),d=Math.sqrt(Math.pow(a,2)/(1+Math.pow(b,2))),b=b*d;this._length=a;this.x=d*c(this.x);this.y=b*c(this.y)}return this}}function o(a,b){this.x=a;this.y=b;this.getVectorToCoordinates=function(a,b){return new l(a-
this.x,b-this.y)};this.getVectorFromCoordinates=function(a,b){return this.getVectorToCoordinates(a,b).reverse()};this.getVectorToPoint=function(a){return new l(a.x-this.x,a.y-this.y)};this.getVectorFromPoint=function(a){return this.getVectorToPoint(a).reverse()}}function s(a){this._storageObject=a;this.startStrokeFn=function(){};this.addToStrokeFn=function(){};this.endStrokeFn=function(){};this.inStroke=!1;this._stroke=this._lastPoint=null;this.startStroke=function(a){if(a&&"number"==typeof a.x&&
"number"==typeof a.y){this._stroke={x:[a.x],y:[a.y]};this._storageObject.push(this._stroke);this._lastPoint=a;this.inStroke=!0;var c=this._stroke,d=this.startStrokeFn;setTimeout(function(){d(c)},3);return a}return null};this.addToStroke=function(a){if(this.inStroke&&"number"===typeof a.x&&"number"===typeof a.y&&2<Math.abs(a.x-this._lastPoint.x)+Math.abs(a.y-this._lastPoint.y)){var c=this._stroke.x.length;this._stroke.x.push(a.x);this._stroke.y.push(a.y);this._lastPoint=a;var d=this._stroke,e=this.addToStrokeFn;
setTimeout(function(){e(d,c)},3);return a}return null};this.endStroke=function(){var a=this.inStroke;this.inStroke=!1;this._lastPoint=null;if(a){var c=this.endStrokeFn,d=this._stroke;setTimeout(function(){c(d)},3);return!0}return null}}var q=function(a){var b={width:"max",height:"max",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0},c=f(this);f.extend(b,n(c));a&&f.extend(b,a);if("max"==b.width||"max"==b.height){var a=c.width(),d=c.height();a/b.sizeRatio>d&&(d=parseInt(a/
b.sizeRatio,10));b.width=a;b.height=d}0==b.lineWidth&&(a=parseInt(b.width,10),a=parseInt(a/300,10),b.lineWidth=2>a?2:a);var e=1E3>parseInt(b.width,10)?!0:!1,k=c.find("canvas"),g;k.length?g=k.get(0):(g=document.createElement("canvas"),g.width=b.width,g.height=b.height,k=f(g),k.appendTo(c));k.addClass("jSignature");var h=!1,p=1;g.getContext||("undefined"!==typeof FlashCanvas?(window&&window.screen&&window.screen.deviceXDPI&&window.screen.logicalXDPI&&(p=window.screen.deviceXDPI/window.screen.logicalXDPI),
g=FlashCanvas.initElement(g),1!=p&&k.children("object").get(0).resize(Math.ceil(g.width*p),Math.ceil(g.height*p)),h=!0):"undefined"!=typeof G_vmlCanvasManager&&(g=G_vmlCanvasManager.initElement(g),h=!0));if(!g.getContext)throw Error("Canvas element does not support 2d context. jSignature cannot proceed.");g.onselectstart=function(a){a&&a.preventDefault&&a.preventDefault();a&&a.stopPropagation&&a.stopPropagation();return false};b.cssclass&&""!=f.trim(b.cssclass)&&k.addClass(b.cssclass);var j=g.getContext("2d"),
r,q,w,z,D,E,F=-1*Math.round(b.lineWidth/2),A=function(a,b,c,d){j.beginPath();j.moveTo(a,b);j.lineTo(c,d);j.stroke()},c=function(a){var c=g.width,d=g.height;j.clearRect(0,0,c*p+30,d*p+30);j.shadowColor=j.fillStyle=b["background-color"];h&&j.fillRect(0,0,c*p+30,d*p+30);j.lineWidth=Math.ceil(parseInt(b.lineWidth,10)*p);j.lineCap=j.lineJoin="round";var m=Math.round(d/5);j.strokeStyle=b["decor-color"];j.shadowOffsetX=0;j.shadowOffsetY=0;A(m*1.5,d-m,c-m*1.5,d-m);j.strokeStyle=b.color;if(!h&&!e){j.shadowColor=
j.strokeStyle;j.shadowOffsetX=j.lineWidth*0.5;j.shadowOffsetY=j.lineWidth*-0.6;j.shadowBlur=0}if(a===void 0)a=[];else for(var c=a.length,i=0;i<c;i++){d=a[i];m=d.x.length;q(d);for(var f=1;f<m;f++)w(d,f);z(d)}r=new s(a);r.startStrokeFn=q;r.addToStrokeFn=w;r.endStrokeFn=z;k.data("jSignature.data",a);return true},v=null,t=function(a){try{a.preventDefault()}catch(b){}clearTimeout(v);r.endStroke()},G=0,H=function(a){a=a.changedTouches&&a.changedTouches.length>0?a.changedTouches[0]:a;return new o(Math.round((a.pageX+
D)*p),Math.round((a.pageY+E)*p)+G)},u=function(a){a.preventDefault();var b=k.offset();D=b.left*-1;E=b.top*-1;r.startStroke(H(a));clearTimeout(v);v=setTimeout(t,750)},B=function(a){a.preventDefault();if(r.inStroke&&r.addToStroke(H(a))){clearTimeout(v);v=setTimeout(t,750)}},C=3*b.lineWidth;q=function(a){var c=a.x[0],a=a.y[0];j.fillStyle=b.color;j.fillRect(c+F,a+F,b.lineWidth,b.lineWidth);j.fillStyle=b["background-color"]};w=function(a,b){var c=new o(a.x[b-1],a.y[b-1]),d=new o(a.x[b],a.y[b]),m=c.getVectorToPoint(d);
if(b>1){var e=new o(a.x[b-2],a.y[b-2]),i=e.getVectorToPoint(c),g;if(i.getLength()>C){g=b>2?(new o(a.x[b-3],a.y[b-3])).getVectorToPoint(e):new l(0,0);var h=i.getLength()/2,f=(new l(g.x+i.x,g.y+i.y)).resizeTo(h),k=(new l(i.x+m.x,i.y+m.y)).reverse().resizeTo(h),i=e.x,h=e.y;g=c.x;var I=c.y,n=e.x+f.x,e=e.y+f.y,f=c.x+k.x,k=c.y+k.y;j.beginPath();j.moveTo(i,h);j.bezierCurveTo(n,e,f,k,g,I);j.stroke()}}m.getLength()<=C&&A(c.x,c.y,d.x,d.y)};z=function(a){var b=a.x.length-1;if(b>0){var c=new o(a.x[b],a.y[b]),
d=new o(a.x[b-1],a.y[b-1]),m=d.getVectorToPoint(c);if(m.getLength()>C)if(b>1){var a=(new o(a.x[b-2],a.y[b-2])).getVectorToPoint(d),e=(new l(a.x+m.x,a.y+m.y)).resizeTo(m.getLength()/2),m=d.x,a=d.y,b=c.x,i=c.y,g=d.x+e.x,d=d.y+e.y,e=c.x,c=c.y;j.beginPath();j.moveTo(m,a);j.bezierCurveTo(g,d,e,c,b,i);j.stroke()}else A(d.x,d.y,c.x,c.y)}};h?k.bind("mousedown.jSignature",function(a){k.unbind("mousedown.jSignature");u(a);k.bind("mousemove.jSignature",B);k.bind("mouseup.jSignature",t);k.bind("mousedown.jSignature",
u)}):(g.ontouchstart=function(a){g.onmousedown=null;G=b.lineWidth*-5<-15?b.lineWidth*-5:-15;u(a);g.ontouchend=t;g.ontouchstart=u;g.ontouchmove=B},g.onmousedown=function(a){g.ontouchstart=null;u(a);g.onmousedown=u;g.onmouseup=t;g.onmousemove=B});k.data("jSignature.reset",c);f(document).bind("mouseup.jSignature",t);c(b.data)},d={"default":function(){return this.toDataURL()},"native":function(a){return a},image:function(){var a=this.toDataURL();if("string"===typeof a&&4<a.length&&"data:"===a.slice(0,
5)&&-1!==a.indexOf(",")){var b=a.indexOf(",");return[a.slice(5,b),a.substr(b+1)]}return[]}},e={"native":function(a,b,c){c(a)}},c={init:function(a){return this.each(function(){q.call(this,a)})},reset:function(a){this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.reset")(a);return this},addPlugin:function(a,b,c){var i={"export":d,"import":e};i.hasOwnProperty(a)&&(i[a][b]=c);return this},listPlugins:function(a){var b={"export":d,"import":e},c=[];if(b.hasOwnProperty(a)){var a=
b[a],i;for(i in a)a.hasOwnProperty(i)&&c.push(i)}return c},getData:function(a){var b=this.find("canvas.jSignature").add(this.filter("canvas.jSignature"));void 0===a&&(a="default");if(0!==b.length&&d.hasOwnProperty(a))return d[a].call(b.get(0),b.data("jSignature.data"))},setData:function(a,b){var c=this.find("canvas.jSignature").add(this.filter("canvas.jSignature"));if(void 0===b&&"string"===typeof a&&(b=a.split(",")[0],b===a))return;0!==c.length&&e.hasOwnProperty(b)&&e[b].call(c.get(0),a,b,c.data("jSignature.reset"));
return this}};f.fn.jSignature=function(a){if(c[a])return c[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return c.init.apply(this,arguments);f.error("Method "+a+" does not exist on jQuery.jSignature")};return f})(this.jQuery)})("undefined"!==typeof window?window:this);/*

 jSignature v2 jSignature's custom "base30" export and import plugins.

 Copyright (c) 2011 Willow Systems Corp http://willow-systems.com

 MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
(function(){for(var f={},n={},l=29;-1<l;l--)f["0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[l]]="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[l+30],n["0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[l+30]]="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX"[l];var o=function(c){for(var c=c.split(""),a=c.length,b=1;b<a;b++)c[b]=f[c[b]];return c.join("")},s=function(c){for(var a=[],b=0,d=1,e=c.length,f,k,g=0;g<e;g++)f=c[g],k=f-b,b=f,0>k&&0<
d?(d=-1,a.push("Z")):0<k&&0>d&&(d=1,a.push("Y")),f=Math.abs(k),30<=f?a.push(o(f.toString(30))):a.push(f.toString(30));return a.join("")},q=function(c){for(var a=[],c=c.split(""),b=c.length,d,e=1,l=[],k=0,g=0;g<b;g++)(d=c[g],d in f||"Z"===d||"Y"===d)?(0!==l.length&&(l=parseInt(l.join(""),30)*e+k,a.push(l),k=l),"Z"===d)?(e=-1,l=[]):"Y"===d?(e=1,l=[]):l=[d]:l.push(n[d]);a.push(parseInt(l.join(""),30)*e+k);return a},d=function(c){for(var a=[],b=c.length,d,e=0;e<b;e++)d=c[e],a.push(s(d.x)),a.push(s(d.y));
return["image/jsignature;base30",a.join("_")]},e=function(c,a,b){if("string"===typeof c){"image/jsignature;base30"===c.substring(0,23).toLowerCase()&&(c=c.substring(24));for(var a=[],c=c.split("_"),d=c.length/2,e=0;e<d;e++)a.push({x:q(c[2*e]),y:q(c[2*e+1])});b(a)}};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(c){c=c.fn.jSignature;c("addPlugin","export","base30",d);c("addPlugin","export","image/jsignature;base30",
d);c("addPlugin","import","base30",e);c("addPlugin","import","image/jsignature;base30",e)})(this.jQuery)}).call("undefined"!==typeof window?window:this);/*

 jSignature v2 SVG export plugin.

 Copyright (c) 2011 Willow Systems Corp http://willow-systems.com

 MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
(function(){function f(d,e){this.x=d;this.y=e;this.reverse=function(){this.x*=-1;this.y*=-1;return this};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var c=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=a,this.y=a*c(this.y);else if(0===this.y)this._length=a,this.x=a*c(this.x);else{var b=Math.abs(this.y/this.x),
d=Math.sqrt(Math.pow(a,2)/(1+Math.pow(b,2))),b=b*d;this._length=a;this.x=d*c(this.x);this.y=b*c(this.y)}return this}}function n(d,e){this.x=d;this.y=e;this.getVectorToCoordinates=function(c,a){return new f(c-this.x,a-this.y)};this.getVectorFromCoordinates=function(c,a){return this.getVectorToCoordinates(c,a).reverse()};this.getVectorToPoint=function(c){return new f(c.x-this.x,c.y-this.y)};this.getVectorFromPoint=function(c){return this.getVectorToPoint(c).reverse()}}var l=function(d,e,c){var e=e+
1,a=new n(d.x[e-1],d.y[e-1]),b=new n(d.x[e],d.y[e]),b=a.getVectorToPoint(b),m=new n(d.x[e-2],d.y[e-2]),a=m.getVectorToPoint(a);return a.getLength()>c?(d=2<e?(new n(d.x[e-3],d.y[e-3])).getVectorToPoint(m):new f(0,0),e=a.getLength()/2,d=(new f(d.x+a.x,d.y+a.y)).resizeTo(e),b=(new f(a.x+b.x,a.y+b.y)).reverse().resizeTo(e),b=new f(a.x+b.x,a.y+b.y),["c",d.x,d.y,b.x,b.y,a.x,a.y]):["l",a.x,a.y]},o=function(d,e){var c=d.x.length-1,a=new n(d.x[c],d.y[c]),b=new n(d.x[c-1],d.y[c-1]),a=b.getVectorToPoint(a);
return 1<c&&a.getLength()>e?(c=(new n(d.x[c-2],d.y[c-2])).getVectorToPoint(b),c=(new f(c.x+a.x,c.y+a.y)).resizeTo(a.getLength()/2),["c",c.x,c.y,a.x,a.y,a.x,a.y]):["l",a.x,a.y]},s=function(d,e,c){for(var e=["M",x=d.x[0]-e,y=d.y[0]-c],c=1,a=d.x.length-1;c<a;c++)e.push.apply(e,l(d,c,1));0<a&&e.push.apply(e,o(d,c,1));return e.join(" ")},q=function(d){var e=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>'],c,a=d.length,b,f=[],i=[],l=b=c=0,k=0;if(0!==a){for(c=0;c<a;c++)b=d[c],f=f.concat(b.x),i=
i.concat(b.y);c=Math.min.apply(null,f)-1;b=Math.max.apply(null,f)+1;f=Math.min.apply(null,i)-1;i=Math.max.apply(null,i)+1;l=0>c?0:c;k=0>f?0:f;c=b-c;b=i-f}e.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+c.toString()+'" height="'+b.toString()+'">');e.push('<style type="text/css"><![CDATA[.f {fill:none;stroke:#000000;stroke-width:2}]]\></style>');for(c=0;c<a;c++)b=d[c],e.push('<path class="f" d="'+s(b,l,k)+'"/>');e.push("</svg>");return["image/svg+xml",e.join("")]};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");
(function(d){d=d.fn.jSignature;d("addPlugin","export","svg",q);d("addPlugin","export","image/svg+xml",q)})(this.jQuery)}).call("undefined"!==typeof window?window:this);
